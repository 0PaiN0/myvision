!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=fabric},function(e,t,n){"use strict";n.r(t);var o=n(0),i=n.n(o);const r={};function a(e,t,n){const o=n.getPointer(t.e);return{radius:3.5,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,left:o.x,top:o.y,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"tempPoint",pointId:e,objectCaching:!1}}function s(e,t){return{radius:3.5,fill:"blue",stroke:"#333333",strokeWidth:.5,left:t.x,top:t.y,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"point",objectCaching:!1,pointId:e,perPixelTargetFind:!0}}function l(e,t){return{radius:4,fill:"red",stroke:"#333333",strokeWidth:.5,left:t.x,top:t.y,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"point",objectCaching:!1,pointId:e,perPixelTargetFind:!0,lockMovementX:!0,lockMovementY:!0}}r.newPolygon={stroke:"rgba(255,0,0)",strokeWidth:1.75,fill:"rgba(237, 237, 237, 0.01)",perPixelTargetFind:!0,hasBorders:!1,hasControls:!1,shapeName:"polygon",selectable:!1,evented:!0,objectCaching:!1,numberOfNullPolygonPoints:0},r.newTempPolygon={stroke:"#333333",strokeWidth:.8,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1},r.newLine={strokeWidth:1.1,fill:"#999999",stroke:"#999999",class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1},r.firstPoint={fill:"red",shapeName:"firstPoint"},r.newPoint=a,r.existingPolygonPoint=s,r.removablePolygonPoint=l;let c=null,u=[],d=null,f=null;function g(e,t,n,o){!function(e,t,n,o){c=e,u=t,d=n,f=o}(e,t,n,o);const r=function(){const e=new i.a.Polygon([],f.newPolygon);return e.set({id:c.id,selectable:!0}),e}();d.add(r);const a=function(e){let t=0;const n=[];return e.forEach(e=>{const o=new i.a.Circle(f.existingPolygonPoint(t,e));d.add(o),u.push(o),n.push({x:o.left-1,y:o.top-1}),t+=1}),n}(function(){const e=c.calcTransformMatrix();return c.get("points").map(e=>new i.a.Point(e.x-c.pathOffset.x,e.y-c.pathOffset.y)).map(t=>i.a.util.transformPoint(t,e))}());return d.remove(c),(c=r).set("points",a),function(){const e=c._calcDimensions();c.set({left:e.left,top:e.top,height:e.height,width:e.width,pathOffset:{x:e.left+e.width/2,y:e.top+e.height/2}}),c.setCoords(),d.renderAll()}(),c}let h=null,p=null,m=[],b=!1;function y(){return b}function w(){p=g(p,m,h,r),b=!0}function v(e,t){h=e,p=t}function x(e,t,n){v(e,t),e.discardActiveObject(),n?function(){let e=0;p.get("points").forEach(t=>{const n=new i.a.Circle(r.removablePolygonPoint(e,t));h.add(n),m.push(n),e+=1})}():function(){let e=0;p.get("points").forEach(t=>{const n=new i.a.Circle(r.existingPolygonPoint(e,t));h.add(n),m.push(n),e+=1})}(),b=!0}function P(){0!==m.length&&(m.forEach(e=>{h.remove(e)}),h.renderAll(),m=[]),b=!1}function C(e){if(p.points.length-p.numberOfNullPolygonPoints>3){if(0===Object.keys(p.points[e]).length)p.points[p.points.length-1]=p.points[e-1],p.points[e-1]={};else if(p.points.length-1===e){for(let t=e-1;t>-1;t-=1)if(0!==Object.keys(p.points[t]).length){p.points[e]=p.points[t],p.points[t]={};break}}else p.points[e]={};h.remove(m[e]),m[e]=null,p.numberOfNullPolygonPoints+=1,p.points.length-p.numberOfNullPolygonPoints>3&&console.log("need to signal restrictions"),h.renderAll()}}let j=!1,N=null;function k(){N.forEachObject(e=>{"bndBox"===e.shapeName?e.selectable=!0:(e.lockMovementX=!1,e.lockMovementY=!1),"point"===e.shapeName&&(e.fill="blue",e.radius=3.5)})}function O(e,t){t?k():e.forEachObject(e=>{e.selectable=!0}),e.defaultCursor="default",e.hoverCursor="move",e.renderAll()}let B=null,A=!1,_=!1,E=null;function I(e){e.target&&"polygon"===e.target.shapeName&&A?function(e){y()&&(P(),_=!0),x(E,e.target,!0),B=e.target.id}(e):(!e.target&&y()||e.target&&"bndBox"===e.target.shapeName)&&(P(),B=null)}function L(e){E.forEachObject(e=>{"bndBox"===e.shapeName?e.selectable=!1:(e.lockMovementX=!0,e.lockMovementY=!0),"tempPoint"!==e.shapeName&&"firstPoint"!==e.shapeName||(e.fill="red",e.radius=4)}),e.defaultCursor="default",e.hoverCursor="default",e.renderAll()}const M={};function W(e,t){return{left:e.origX,top:e.origY,width:t.x-e.origX,height:t.y-e.origY,stroke:"rgba(255,0,0)",strokeWidth:2,fill:"rgba(255,0,0,0)",shapeName:"bndBoxTemp"}}function X(e,t){const n=document.getElementById("labelNamePopUp");n.style.display="block";const o=document.getElementById("canvas-wrapper").getBoundingClientRect(),i=o.top,r=o.left;n.style.top=`${t+i}px`,n.style.left=`${e+r}px`}function Y(){document.getElementById("labelNamePopUp").style.display="none"}M.tempBndBoxProps=W,M.finalBndBoxProps={fill:"rgba(255,0,0,0)",shapeName:"bndBox",objectCaching:!1,selectable:!1};const T={};let U=!1,$=null,H=null,R=0;function S(e,t){$=e,H=t,U=!0}function F(){const e=document.getElementById("label-title").value;O(H),Y(),$.set("id",R),R+=1,T[$[$.id]]=e,U=!1}function D(){return U}function z(e){e.discardActiveObject(),e.renderAll(),e.forEachObject(e=>{e.selectable=!1}),e.defaultCursor="crosshair",e.hoverCursor="crosshair"}let q=null,G=!1,J=!1;const K={};function Q(e){(q=e).backgroundImage&&(G=!0,z(q),q.discardActiveObject()),e.on("mouse:down",()=>{!function(){if(G){J=!0;const e=q.getPointer(q.e);K.origX=e.x,K.origY=e.y,K.rect=new i.a.Rect(M.tempBndBoxProps(K,e)),q.add(K.rect)}}()}),e.on("mouse:move",e=>{!function(e){if(!J)return;const t=q.getPointer(e.e);K.origX>t.x&&K.rect.set({left:Math.abs(t.x)}),K.origY>t.y&&K.rect.set({top:Math.abs(t.y)}),K.rect.set({width:Math.abs(K.origX-t.x)}),K.rect.set({height:Math.abs(K.origY-t.y)}),q.renderAll()}(e)}),e.on("mouse:up",e=>{!function(e){if(J){G=!1,J=!1,K.rect.setCoords(),K.rect.set(M.finalBndBoxProps),O(q);const t=q.getPointer(e.e);S(K.rect,q),X(t.x,t.y)}}(e)})}let V=null,Z=[],ee=[],te=!0,ne=null,oe=!1,ie=0;function re(){ee.forEach(e=>{V.remove(e)}),V.remove(oe).remove(ne)}function ae(){Z[0]&&(Z.forEach(e=>{V.remove(e)}),re(),Z=[],ee=[],oe=null,ne=null,ie=0)}function se(e){e.target&&e.target.shapeName&&"firstPoint"===e.target.shapeName&&function(e){const t=[];Z.forEach(e=>{t.push({x:e.left,y:e.top}),V.remove(e)}),re();const n=new i.a.Polygon(t,r.newPolygon);V.add(n),ne=null,oe=null,te=!1;const o=V.getPointer(e.e);S(n,V),X(o.x,o.y)}(e),te&&function(e){const t=V.getPointer(e.e),n=new i.a.Circle(r.newPoint(ie,e,V));ie+=1,0===Z.length&&n.set(r.firstPoint);let o=[t.x,t.y,t.x,t.y];const a=new i.a.Line(o,r.newLine);if(oe){(o=oe.get("points")).push({x:t.x,y:t.y});const e=new i.a.Polygon(o,r.newTempPolygon);V.remove(oe),V.add(e),oe=e,V.renderAll()}else{const e=[{x:t.x,y:t.y}],n=new i.a.Polygon(e,r.newTempPolygon);oe=n,V.add(n)}ne=a,Z.push(n),ee.push(a),V.add(n),V.selection=!1}(e)}function le(e){V=e,te=!0,ae(),V.discardActiveObject(),z(V),e.on("mouse:down",e=>{(!e.target||e.target&&"tempPoint"!==e.target.shapeName)&&se(e)}),e.on("object:moving",e=>{!function(e){oe&&(oe.points[e.target.pointId]={x:e.target.getCenterPoint().x,y:e.target.getCenterPoint().y})}(e)}),e.on("mouse:move",e=>{!function(e){if(ne&&"line"===ne.class){const t=V.getPointer(e.e);ne.set({x2:t.x,y2:t.y});const n=oe.get("points");n[Z.length]={x:t.x,y:t.y},oe.set({points:n})}V.renderAll()}(e)}),e.on("mouse:over",t=>{t.target&&t.target.selectable?e.hoverCursor="move":e.hoverCursor="crosshair"})}function ce(e){E=e,e.on("mouse:down",e=>{!function(e){e.target&&("polygon"===e.target.shapeName&&e.target.id!==B?A=!0:"point"===e.target.shapeName&&C(e.target.pointId))}(e)}),e.on("mouse:over",e=>{!function(e){!e.target||"tempPoint"!==e.target.shapeName&&"firstPoint"!==e.target.shapeName||(e.target.stroke="red",E.renderAll())}(e)}),e.on("mouse:up",e=>{I(e)}),e.on("mouse:out",e=>{!function(e){!e.target||"tempPoint"!==e.target.shapeName&&"firstPoint"!==e.target.shapeName||(e.target.stroke="black",E.renderAll())}(e)})}let ue=!1,de=!1,fe=null,ge=!1;function he(e,t){var n,o;ge?(n=t,o=e.target,v(n,o),n.discardActiveObject(),w(),fe=e.target.id):w(),ue=!1}function pe(){!function(){const e=p._calcDimensions();p.set({left:e.left,top:e.top,height:e.height,width:e.width,pathOffset:{x:e.left+e.width/2,y:e.top+e.height/2}}),p.setCoords(),h.renderAll()}(),de=!1}function me(){P(),fe=null}function be(e,t){ue?he(e,t):ge?function(e,t){y()&&P(),x(t,e.target),fe=e.target.id}(e,t):de?pe():e.target&&"polygon"===e.target.shapeName?(h.discardActiveObject(),m.forEach(e=>{e&&e.bringForward()}),b=!0):!e.target&&y()&&me()}function ye(e){e.target&&("polygon"===e.target.shapeName?(y()&&P(),ue=!0):"point"===e.target.shapeName&&(!function(e){const{left:t}=e.target,{top:n}=e.target,o=e.target;p.points[o.pointId]={x:t,y:n}}(e),de=!0))}function we(e){e.on("mouse:down",e=>{!function(e){e.target?"bndBox"===e.target.shapeName&&y()?(me(),ge=!1):ge="polygon"===e.target.shapeName&&e.target.id!==fe:ge=!1}(e)}),e.on("mouse:up",t=>{be(t,e)}),e.on("object:moving",e=>{ye(e)}),e.on("object:scaling",e=>{!function(e){if("bndBox"===e.target.shapeName){const t=e.target;t.width*=t.scaleX,t.height*=t.scaleY,t.scaleX=1,t.scaleY=1}}(e)}),e.on("mouse:over",t=>{!function(e,t){e.target&&"point"!==e.target.shapeName&&(e.target.set("fill","rgba(255,0,0,0.2)"),t.renderAll())}(t,e)}),e.on("mouse:out",t=>{t.target&&"point"!==t.target.shapeName&&("bndBox"===t.target.shapeName?function(e){e.target.set("fill","rgba(255,0,0,0")}(t):"polygon"===t.target.shapeName&&function(e){e.target.set("fill","rgba(255,0,0,0.01)")}(t),e.renderAll())})}function ve(e){e.__eventListeners&&(e.__eventListeners["mouse:down"]=[],e.__eventListeners["mouse:over"]=[],e.__eventListeners["mouse:out"]=[],e.__eventListeners["mouse:move"]=[],e.__eventListeners["mouse:up"]=[],e.__eventListeners["object:moving"]=[])}let xe=null,Pe=!1,Ce=!1;function je(){ve(xe),Q(xe),Pe=!1}function Ne(){ve(xe),le(xe),Pe=!1}function ke(){xe.getActiveObject()?xe.remove(xe.getActiveObject()):p&&h.remove(p)}function Oe(){Pe||(ve(xe),O(xe,Ce),we(xe),Ce&&(Ce=!1),Pe=!0)}function Be(){ve(xe),ce(xe),L(xe),Pe=!1,Ce=!0}const Ae={uploaded:!1,name:null},_e={};let Ee=null;function Ie(e,t){t?function(e,t){Ee.setWidth(t.width),Ee.setHeight(t.height),i.a.Image.fromURL(e.src,e=>{Ee.setBackgroundImage(e,Ee.renderAll.bind(Ee),{scaleX:Ee.width/e.width,scaleY:Ee.height/e.height})})}(e,t):function(e){Ee.setWidth(e.width),Ee.setHeight(e.height),Ee.setBackgroundColor({source:e.src},()=>{Ee.renderAll()})}(e)}function Le(e){const t={},n=_e.maximumCanvasWidth/e.width;return t.width=_e.maximumCanvasWidth,t.height=e.height*n,t}function Me(){Ae.uploaded=!0;const e=this;if(_e.maximumCanvasHeight<e.height){let t=function(e){const t={},n=_e.maximumCanvasHeight/e.height;return t.height=_e.maximumCanvasHeight,t.width=e.width*n,t}(e);_e.maximumCanvasWidth<t.width&&(t=Le(t)),Ie(e,t)}else if(_e.maximumCanvasWidth<e.width){Ie(e,Le(e))}else Ie(e)}function We(e){const t=new Image;t.src=e.target.result,t.onload=Me}function Xe(e){Ee=e,_e.maximumCanvasHeight=window.innerHeight-54,_e.maximumCanvasWidth=window.innerWidth-110}function Ye(e){return function e(t){let n="";return Object.keys(t).forEach(o=>{"object"==typeof t[o]?n+=`<${o}>${e(t[o])}</${o}>`:n+=`<${o}>${t[o]}</${o}>`}),n}(e)}let Te=null;function Ue(e){const t=document.createElement("a"),n=new Blob([e],{type:"text/plain"});return t.setAttribute("href",window.URL.createObjectURL(n)),t.setAttribute("download",`${new RegExp("^([^.]+)").exec(Ae.name)[0]}.xml`),t.dataset.downloadurl=["text/plain",t.download,t.href].join(":"),t.draggable=!0,t.classList.add("dragout"),t}function $e(){if(Te.backgroundImage){!function(e){Ue(e).click()}(Ye(function(e,t){const n={};return n.annotations=function(e,t){return{folder:"Unknown",filename:t.name,path:"Unknown",source:{database:"Unknown"},size:{width:e.getWidth(),height:e.getHeight(),depth:1},segmented:0}}(e,t),n.annotations.object=function(e){let t={};return e.forEachObject(e=>{const n=e._objects[0],o=e._objects[1].text;t={name:o,pose:"Unspecified",truncated:1,difficult:0,bndbox:{xmin:n.left,ymin:n.top,xmax:n.left+n.width,ymax:n.top+n.height}}}),t}(e),n}(Te,Ae)))}}function He(){F(),Oe()}function Re(){D()&&(Y(),H.remove($),U=!1)}function Se(){ae(),Re(),P(),fe=null,j&&(k(),j=!1)}function Fe(e){Se(),e&&e()}function De(e){Se(),function(e){if(e.files&&e.files[0]){const t=new FileReader;Ae.name=e.files[0].name,t.onload=We,t.readAsDataURL(e.files[0])}}(e)}!function(){const e=new i.a.Canvas("c",{selection:!1});i.a.Object.prototype.transparentCorners=!1,xe=e,Xe(e),function(e){Te=e}(e)}(),function(){window.createNewBndBox=Fe.bind(this,je),window.createNewPolygon=Fe.bind(this,Ne),window.removePoint=function(e){D()||e&&e()}.bind(this,Be),window.removeShape=Fe.bind(this,ke),window.downloadXML=Fe.bind(this,$e),window.cancel=Fe.bind(this,Oe),window.uploadImage=De,window.labelShape=He}()}]);