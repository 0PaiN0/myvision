!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=fabric},function(e,t,n){"use strict";function o(e){e.__eventListeners&&(e.__eventListeners["mouse:down"]=[],e.__eventListeners["mouse:over"]=[],e.__eventListeners["mouse:out"]=[],e.__eventListeners["mouse:move"]=[],e.__eventListeners["mouse:up"]=[],e.__eventListeners["object:moving"]=[])}n.r(t);var i=n(0),r=n.n(i);const a={};function l(e,t){return{left:e.origX,top:e.origY,width:t.x-e.origX,height:t.y-e.origY,stroke:"rgba(255,0,0)",strokeWidth:2,fill:"rgba(255,0,0,0)",shapeName:"bndBoxTemp"}}function s(e,t){const n=document.getElementById("labelNamePopUp");n.style.display="block";const o=document.getElementById("canvas-wrapper").getBoundingClientRect(),i=o.top,r=o.left;n.style.top=`${t+i}px`,n.style.left=`${e+r}px`}function c(){document.getElementById("labelNamePopUp").style.display="none"}a.tempBndBoxProps=l,a.finalBndBoxProps={fill:"rgba(255,0,0,0)",shapeName:"bndBox",objectCaching:!1,selectable:!1};const u={};function f(e,t){return{radius:3.5,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,left:t.x,top:t.y,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"tempPoint",pointId:e,objectCaching:!1}}function d(e){return{radius:3.5,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,selectable:!0,shapeName:"tempPoint",pointId:e,lockMovementX:!1,lockMovementY:!1}}function g(e,t){return{radius:3.5,fill:"blue",stroke:"#333333",strokeWidth:.5,left:t.x,top:t.y,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"point",objectCaching:!1,pointId:e,perPixelTargetFind:!0}}function h(e,t){const n={radius:4,fill:"red",stroke:"#333333",strokeWidth:.5,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"point",objectCaching:!1,pointId:e,perPixelTargetFind:!0,lockMovementX:!0,lockMovementY:!0};return t&&(n.left=t.x,n.top=t.y),n}function p(e,t){const n={radius:4,fill:"green",stroke:"#333333",strokeWidth:.5,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"point",objectCaching:!1,pointId:e,perPixelTargetFind:!0,lockMovementX:!0,lockMovementY:!0};return t&&(n.left=t.x,n.top=t.y),n}u.newPolygon={stroke:"rgba(255,0,0)",strokeWidth:1.75,fill:"rgba(237, 237, 237, 0.01)",perPixelTargetFind:!0,hasBorders:!1,hasControls:!1,shapeName:"polygon",selectable:!1,evented:!0,objectCaching:!1,numberOfNullPolygonPoints:0},u.newTempPolygon={stroke:"#333333",strokeWidth:.8,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1,numberOfNullPolygonPoints:-3},u.newLine={strokeWidth:1.1,fill:"#999999",stroke:"#999999",class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1},u.firstPoint={fill:"red",shapeName:"firstPoint",lockMovementX:!0,lockMovementY:!0},u.removablePoint={fill:"red",radius:4},u.defaultPoint={fill:"blue",radius:3.5},u.additionalPoint={fill:"green",radius:4},u.disabledButton={fill:"white",radius:3},u.newPoint=f,u.changeRemovablePointToTemp=d,u.existingPolygonPoint=g,u.removablePolygonPoint=h,u.initialAddPolygonPoint=p;let m=null,b=[],v=null,y=null;function w(e,t,n,o){!function(e,t,n,o){m=e,b=t,v=n,y=o}(e,t,n,o);const i=function(){const e=new r.a.Polygon([],y.newPolygon);return e.set({id:m.id,selectable:!0}),e}();v.add(i);const a=function(e){let t=0;const n=[];return e.forEach(e=>{const o=new r.a.Circle(y.existingPolygonPoint(t,e));v.add(o),b.push(o),n.push({x:o.left-1,y:o.top-1}),t+=1}),n}(function(){const e=m.calcTransformMatrix();return m.get("points").map(e=>new r.a.Point(e.x-m.pathOffset.x,e.y-m.pathOffset.y)).map(t=>r.a.util.transformPoint(t,e))}());return v.remove(m),(m=i).set("points",a),function(){const e=m._calcDimensions();m.set({left:e.left,top:e.top,height:e.height,width:e.width,pathOffset:{x:e.left+e.width/2,y:e.top+e.height/2}}),m.setCoords(),v.renderAll()}(),m}function x(e){"bndBox"===e.shapeName?e.selectable=!1:(e.lockMovementX=!0,e.lockMovementY=!0)}function P(e,t,n,o){let i=0;t.get("points").forEach(t=>{const a=new r.a.Circle(o(i,t));e.add(a),n.push(a),i+=1})}let k=null,N=null,j=[],C=!1;function O(){return C}function A(){j=function(e){let t=0;const n=[];return e.forEachObject(e=>{"tempPoint"!==e.shapeName&&"firstPoint"!==e.shapeName||(e.set(u.removablePolygonPoint(t)),n.push(e),t+=1)}),n}(k)}function B(){var e,t;e=k,j=0!==(t=j).length?(t.forEach(t=>{e.remove(t)}),e.renderAll(),[]):t,C=!1}function _(){k.forEachObject(e=>{x(e),"point"===e.shapeName&&e.set(u.defaultPoint)})}function E(){N=w(N,j,k,u),C=!0}function M(e,t){k=e,N=t}function X(e){!function(e,t,n,o){if(t.points.length-t.numberOfNullPolygonPoints>3){if(0===Object.keys(t.points[o]).length){for(let e=o-1;e>-1;e-=1)if(0!==Object.keys(t.points[e]).length){t.points[t.points.length-1]=t.points[e],t.points[e]={};break}}else if(t.points.length-1===o){for(let e=o-1;e>-1;e-=1)if(0!==Object.keys(t.points[e]).length){t.points[o]=t.points[e],t.points[e]={};break}}else t.points[o]={};e.remove(n[o]),n[o]=null,t.numberOfNullPolygonPoints+=1,t.points.length-t.numberOfNullPolygonPoints>3&&console.log("need to signal restrictions"),e.renderAll()}}(k,N,j,e)}function I(e,t,n,o,i){M(e,t),e.discardActiveObject(),N.bringForward(),i?P(k,N,j,u.initialAddPolygonPoint):n?o?A():P(k,N,j,u.removablePolygonPoint):P(k,N,j,u.existingPolygonPoint),C=!0}function Y(e,t){t?_():e.forEachObject(e=>{e.selectable=!0}),e.defaultCursor="default",e.hoverCursor="move",e.renderAll()}const W={};let T=!1,L=null,R=null,U=0;function S(e,t){L=e,R=t,T=!0}function $(){const e=document.getElementById("label-title").value;Y(R),c(),L.set("id",U),U+=1,W[L[L.id]]=e,T=!1}function H(){return T}function F(e,t){e.discardActiveObject(),t||function(e){e.forEachObject(e=>{e.selectable=!1})}(e),e.defaultCursor="crosshair",e.hoverCursor="crosshair",e.renderAll()}let D=null,z=!1,q=!1;const G={};function J(e){(D=e).backgroundImage&&(z=!0,F(D),D.discardActiveObject()),e.on("mouse:down",()=>{!function(){if(z){q=!0;const e=D.getPointer(D.e);G.origX=e.x,G.origY=e.y,G.rect=new r.a.Rect(a.tempBndBoxProps(G,e)),D.add(G.rect)}}()}),e.on("mouse:move",e=>{!function(e){if(!q)return;const t=D.getPointer(e.e);G.origX>t.x&&G.rect.set({left:Math.abs(t.x)}),G.origY>t.y&&G.rect.set({top:Math.abs(t.y)}),G.rect.set({width:Math.abs(G.origX-t.x)}),G.rect.set({height:Math.abs(G.origY-t.y)}),D.renderAll()}(e)}),e.on("mouse:up",e=>{!function(e){if(q){z=!1,q=!1,G.rect.setCoords(),G.rect.set(a.finalBndBoxProps),Y(D);const t=D.getPointer(e.e);S(G.rect,D),s(t.x,t.y)}}(e)})}let K=!1,Q=!1,V=!1;function Z(){return Q||V}function ee(){return Q}function te(e){K=e}function ne(e){Q=e,V=e}function oe(e){Q=e}function ie(e){V=e}let re=null,ae=[],le=!0,se=!1,ce=0,ue=null;function fe(){re.remove(se),se=null}function de(){return null!==se}function ge(e){const t=re.getPointer(e.e);(function(e){return!(!se||ue.x===e.x)})(t)||(e.target&&e.target.shapeName&&"firstPoint"===e.target.shapeName?function(e){const t=[];ae.forEach(e=>{t.push({x:e.left,y:e.top}),re.remove(e)}),fe();const n=new r.a.Polygon(t,u.newPolygon);re.add(n),se=null,le=!1,S(n,re),s(e.x,e.y)}(t):le&&function(e){const t=new r.a.Circle(u.newPoint(ce,e));ce+=1,0===ae.length&&t.set(u.firstPoint);let n=[e.x,e.y,e.x,e.y];if(se){(n=se.get("points")).push({x:e.x,y:e.y});const t=new r.a.Polygon(n,u.newTempPolygon);re.remove(se),re.add(t),se=t,re.renderAll()}else{const t=[{x:e.x,y:e.y}],n=new r.a.Polygon(t,u.newTempPolygon);se=n,re.add(n)}ae.push(t),re.add(t),re.selection=!1}(t))}function he(){!function(){const e=se.get("points"),t=[];e.forEach(e=>{Object.keys(e).length>0&&t.push({x:e.x,y:e.y})}),se.set({points:t}),re.renderAll();let n=0;const o=[];re.forEachObject(e=>{"point"===e.shapeName&&(e.set(u.changeRemovablePointToTemp(n)),0===n&&e.set(u.firstPoint),n+=1,o.push(e))}),ae=o,ce=n,re.renderAll(),t[ae.length]={x:t[0].x,y:t[0].y},se.set({points:t}),re.renderAll(),F(re,!0),re.renderAll()}()}function pe(e,t){t?he():(le=!0,(re=e).discardActiveObject(),F(re)),e.on("mouse:down",e=>{(!e.target||e.target&&"tempPoint"!==e.target.shapeName)&&ge(e)}),e.on("object:moving",e=>{!function(e){if(se){const t=e.target.getCenterPoint().x,n=e.target.getCenterPoint().y;se.points[e.target.pointId]={x:t,y:n}}}(e)}),e.on("mouse:move",e=>{!function(e){if(se){const t=re.getPointer(e.e);ue=t;const n=se.get("points");n[ae.length]={x:t.x,y:t.y},se.set({points:n})}re.renderAll()}(e)}),e.on("mouse:over",t=>{t.target&&t.target.selectable?e.hoverCursor="move":e.hoverCursor="crosshair"})}function me(e){e.getActiveObject()?e.remove(e.getActiveObject()):function(){var e,t;C&&(e=k,(t=N)&&e.remove(t))}(),ne(!1)}function be(e){!function(e){e.forEachObject(e=>{"point"===e.shapeName&&(e.set(u.disabledButton),e.selectable=!1)}),e.renderAll()}(e),e.defaultCursor="default",e.hoverCursor="default"}function ve(e){e.preserveObjectStacking=!1}function ye(e){e&&(e.preserveObjectStacking=!0)}let we=!1,xe=!1,Pe=null,ke=!1,Ne=null;function je(e){var t,n;ke?(t=Ne,n=e.target,M(t,n),t.discardActiveObject(),E(),Pe=e.target.id):E(),we=!1}function Ce(){!function(e,t){const n=t._calcDimensions();t.set({left:n.left,top:n.top,height:n.height,width:n.width,pathOffset:{x:n.left+n.width/2,y:n.top+n.height/2}}),t.setCoords(),e.renderAll()}(k,N),xe=!1}function Oe(){B(),Pe=null}function Ae(e){var t;we?je(e):ke?function(e){O()&&B(),I(Ne,e.target),Pe=e.target.id}(e):xe?Ce():e.target&&"polygon"===e.target.shapeName?(t=j,k.discardActiveObject(),t.forEach(e=>{e&&e.bringForward()}),C=!0):!e.target&&O()&&Oe()}function Be(e){e.target&&("polygon"===e.target.shapeName?(O()&&B(),we=!0):"point"===e.target.shapeName&&(!function(e){!function(e,t){const{left:n}=e.target,{top:o}=e.target,i=e.target;t.points[i.pointId]={x:n,y:o}}(e,N)}(e),xe=!0))}function _e(){Pe=null}let Ee=null,Me=!1,Xe=null;function Ie(e){e.target&&"polygon"===e.target.shapeName&&Me?function(e){O()||(_e(),I(Xe,e.target,!1,!1,!0),Ee=e.target.id)}(e):(!e.target&&O()||e.target&&"bndBox"===e.target.shapeName)&&(B(),Ee=null)}function Ye(e){Xe=e,e.on("mouse:down",e=>{!function(e){e.target&&(ve(Xe),"point"===e.target.shapeName?be(Xe):(Me="polygon"===e.target.shapeName&&e.target.id!==Ee,ye(Xe)))}(e)}),e.on("mouse:over",()=>{}),e.on("mouse:up",e=>{Ie(e)}),e.on("mouse:out",()=>{})}function We(e){!function(e){e.forEachObject(e=>{"bndBox"===e.shapeName?e.selectable=!1:(e.lockMovementX=!0,e.lockMovementY=!0),"point"===e.shapeName&&e.set(u.additionalPoint)}),e.renderAll()}(e),e.defaultCursor="default",e.hoverCursor="default"}function Te(e,t){var n;Ne=e,(n=t)&&(Pe=n),e.on("mouse:down",e=>{!function(e){e.target?(ve(Ne),"bndBox"===e.target.shapeName&&O()?(Oe(),ke=!1):(ke="polygon"===e.target.shapeName&&e.target.id!==Pe,ye(Ne))):ke=!1}(e)}),e.on("mouse:up",e=>{Ae(e)}),e.on("object:moving",e=>{Be(e)}),e.on("object:scaling",e=>{!function(e){if("bndBox"===e.target.shapeName){const t=e.target;t.width*=t.scaleX,t.height*=t.scaleY,t.scaleX=1,t.scaleY=1}}(e)}),e.on("mouse:over",e=>{!function(e){e.target&&"point"!==e.target.shapeName&&(e.target.set("fill","rgba(255,0,0,0.2)"),Ne.renderAll())}(e)}),e.on("mouse:out",t=>{t.target&&"point"!==t.target.shapeName&&("bndBox"===t.target.shapeName?function(e){e.target.set("fill","rgba(255,0,0,0")}(t):"polygon"===t.target.shapeName&&function(e){e.target.set("fill","rgba(255,0,0,0.01)")}(t),e.renderAll())})}function Le(e){K||(o(e),Y(e,Z()),Te(e),Z()&&te(!1),te(!0))}function Re(e){!function(e){e.forEachObject(e=>{x(e),"point"===e.shapeName&&e.set(u.removablePoint)}),e.renderAll()}(e),e.defaultCursor="default",e.hoverCursor="default"}let Ue=null,Se=!1,$e=null;function He(e){e.target&&"polygon"===e.target.shapeName&&Se?function(e){O()||(_e(),I($e,e.target,!0),Ue=e.target.id)}(e):(!e.target&&O()||e.target&&"bndBox"===e.target.shapeName)&&(B(),Ue=null)}function Fe(e){$e=e,e.on("mouse:down",e=>{!function(e){e.target&&(ve($e),"point"===e.target.shapeName?X(e.target.pointId):("polygon"===e.target.shapeName&&e.target.id!==Ue&&(Se=!0),ye($e)))}(e)}),e.on("mouse:over",e=>{!function(e){e.target&&"point"===e.target.shapeName&&(e.target.stroke="red",$e.renderAll())}(e)}),e.on("mouse:up",e=>{He(e)}),e.on("mouse:out",e=>{!function(e){e.target&&"point"===e.target.shapeName&&(e.target.stroke="black",$e.renderAll())}(e)})}let De=null;function ze(e){var t;t=e,se.get("points").length-=1,I(De=t,se,!0,!0),e.on("mouse:down",e=>{!function(e){e.target&&"point"===e.target.shapeName&&X(e.target.pointId)}(e)}),e.on("mouse:over",e=>{!function(e){e.target&&"point"===e.target.shapeName&&(e.target.stroke="red",De.renderAll())}(e)}),e.on("mouse:up",e=>{}),e.on("mouse:out",e=>{!function(e){e.target&&"point"===e.target.shapeName&&(e.target.stroke="black",De.renderAll())}(e)})}function qe(e){if(de())pe(e,!0),te(!1);else{Y(e,!0),Te(e,Ue),te(!0)}}function Ge(e){ee()?(o(e),qe(e),oe(!1)):(V&&ie(!1),o(e),function(e){const t=de();t?ze(e):t||Fe(e)}(e),function(e){const t=de();t?function(e){e.defaultCursor="default",e.hoverCursor="default",e.renderAll()}(e):t||Re(e)}(e),te(!1),oe(!0))}const Je={uploaded:!1,name:null},Ke={};let Qe=null;function Ve(e,t){t?function(e,t){Qe.setWidth(t.width),Qe.setHeight(t.height),r.a.Image.fromURL(e.src,e=>{Qe.setBackgroundImage(e,Qe.renderAll.bind(Qe),{scaleX:Qe.width/e.width,scaleY:Qe.height/e.height})})}(e,t):function(e){Qe.setWidth(e.width),Qe.setHeight(e.height),Qe.setBackgroundColor({source:e.src},()=>{Qe.renderAll()})}(e)}function Ze(e){const t={},n=Ke.maximumCanvasWidth/e.width;return t.width=Ke.maximumCanvasWidth,t.height=e.height*n,t}function et(){Je.uploaded=!0;const e=this;if(Ke.maximumCanvasHeight<e.height){let t=function(e){const t={},n=Ke.maximumCanvasHeight/e.height;return t.height=Ke.maximumCanvasHeight,t.width=e.width*n,t}(e);Ke.maximumCanvasWidth<t.width&&(t=Ze(t)),Ve(e,t)}else if(Ke.maximumCanvasWidth<e.width){Ve(e,Ze(e))}else Ve(e)}function tt(e){const t=new Image;t.src=e.target.result,t.onload=et}function nt(e){Qe=e,Ke.maximumCanvasHeight=window.innerHeight-54,Ke.maximumCanvasWidth=window.innerWidth-110}function ot(e){return function e(t){let n="";return Object.keys(t).forEach(o=>{"object"==typeof t[o]?n+=`<${o}>${e(t[o])}</${o}>`:n+=`<${o}>${t[o]}</${o}>`}),n}(e)}let it=null;function rt(e){const t=document.createElement("a"),n=new Blob([e],{type:"text/plain"});return t.setAttribute("href",window.URL.createObjectURL(n)),t.setAttribute("download",`${new RegExp("^([^.]+)").exec(Je.name)[0]}.xml`),t.dataset.downloadurl=["text/plain",t.download,t.href].join(":"),t.draggable=!0,t.classList.add("dragout"),t}function at(){rt(ot(function(e,t){const n={};return n.annotations=function(e,t){return{folder:"Unknown",filename:t.name,path:"Unknown",source:{database:"Unknown"},size:{width:e.getWidth(),height:e.getHeight(),depth:1},segmented:0}}(e,t),n.annotations.object=function(e){let t={};return e.forEachObject(e=>{const n=e._objects[0],o=e._objects[1].text;t={name:o,pose:"Unspecified",truncated:1,difficult:0,bndbox:{xmin:n.left,ymin:n.top,xmax:n.left+n.width,ymax:n.top+n.height}}}),t}(e),n}(it,Je))).click()}function lt(e){!function(e){if(e.files&&e.files[0]){const t=new FileReader;Je.name=e.files[0].name,t.onload=tt,t.readAsDataURL(e.files[0])}}(e)}let st=null;function ct(){var e;o(e=st),J(e),te(!1),ne(!1)}function ut(){var e;o(e=st),pe(e),te(!1),ne(!1)}function ft(){var e;e=st,ee()&&oe(!1),o(e),Ye(e),We(e),te(!1),ie(!0)}function dt(){me(st)}function gt(){Le(st)}function ht(){Ge(st)}function pt(){st.backgroundImage&&at()}function mt(e){lt(e)}function bt(){$(),gt()}function vt(){H()&&(c(),R.remove(L),T=!1)}function yt(){ae[0]&&(ae.forEach(e=>{re.remove(e)}),fe(),ae=[],se=null,ce=0),vt(),B(),_e(),Z()&&(_(),ne(!1))}function wt(e){yt(),e&&e()}function xt(e){H()||e&&e()}!function(){const e=new r.a.Canvas("c",{selection:!1});r.a.Object.prototype.transparentCorners=!1,st=e,nt(e),function(e){it=e}(e)}(),function(){window.createNewBndBox=wt.bind(this,ct),window.createNewPolygon=wt.bind(this,ut),window.addPoints=xt.bind(this,ft),window.removePoint=xt.bind(this,ht),window.removeShape=wt.bind(this,dt),window.downloadXML=wt.bind(this,pt),window.cancel=wt.bind(this,gt),window.uploadImage=function(e,t,n){yt(),t&&t(n)}.bind(this,this,mt)}(),window.labelShape=bt}]);