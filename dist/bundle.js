!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=fabric},function(e,t,n){"use strict";n.r(t);var o=n(0),i=n.n(o);const r={};function a(e,t){return{radius:3.5,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,left:t.x,top:t.y,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"tempPoint",pointId:e,objectCaching:!1}}function s(e){return{radius:3.5,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,selectable:!0,shapeName:"tempPoint",pointId:e,lockMovementX:!1,lockMovementY:!1}}function l(e,t){return{radius:3.5,fill:"blue",stroke:"#333333",strokeWidth:.5,left:t.x,top:t.y,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"point",objectCaching:!1,pointId:e,perPixelTargetFind:!0}}function c(e,t){const n={radius:4,fill:"red",stroke:"#333333",strokeWidth:.5,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"point",objectCaching:!1,pointId:e,perPixelTargetFind:!0,lockMovementX:!0,lockMovementY:!0};return t&&(n.left=t.x,n.top=t.y),n}r.newPolygon={stroke:"rgba(255,0,0)",strokeWidth:1.75,fill:"rgba(237, 237, 237, 0.01)",perPixelTargetFind:!0,hasBorders:!1,hasControls:!1,shapeName:"polygon",selectable:!1,evented:!0,objectCaching:!1,numberOfNullPolygonPoints:0},r.newTempPolygon={stroke:"#333333",strokeWidth:.8,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1,numberOfNullPolygonPoints:-3},r.newLine={strokeWidth:1.1,fill:"#999999",stroke:"#999999",class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1},r.firstPoint={fill:"red",shapeName:"firstPoint",lockMovementX:!0,lockMovementY:!0},r.newPoint=a,r.changeRemovablePointToTemp=s,r.existingPolygonPoint=l,r.removablePolygonPoint=c;let u=null,f=[],d=null,g=null;function h(e,t,n,o){!function(e,t,n,o){u=e,f=t,d=n,g=o}(e,t,n,o);const r=function(){const e=new i.a.Polygon([],g.newPolygon);return e.set({id:u.id,selectable:!0}),e}();d.add(r);const a=function(e){let t=0;const n=[];return e.forEach(e=>{const o=new i.a.Circle(g.existingPolygonPoint(t,e));d.add(o),f.push(o),n.push({x:o.left-1,y:o.top-1}),t+=1}),n}(function(){const e=u.calcTransformMatrix();return u.get("points").map(e=>new i.a.Point(e.x-u.pathOffset.x,e.y-u.pathOffset.y)).map(t=>i.a.util.transformPoint(t,e))}());return d.remove(u),(u=r).set("points",a),function(){const e=u._calcDimensions();u.set({left:e.left,top:e.top,height:e.height,width:e.width,pathOffset:{x:e.left+e.width/2,y:e.top+e.height/2}}),u.setCoords(),d.renderAll()}(),u}let p=null,m=null,b=[],y=!1;function v(){return y}function w(){m=h(m,b,p,r),y=!0}function x(e,t){p=e,m=t}function P(e,t,n,o){x(e,t),e.discardActiveObject(),n?o?function(){let e=0;b=[],p.forEachObject(t=>{"tempPoint"!==t.shapeName&&"firstPoint"!==t.shapeName||(t.set(r.removablePolygonPoint(e)),b.push(t),e+=1)})}():function(){let e=0;m.get("points").forEach(t=>{const n=new i.a.Circle(r.removablePolygonPoint(e,t));p.add(n),b.push(n),e+=1})}():function(){let e=0;m.get("points").forEach(t=>{const n=new i.a.Circle(r.existingPolygonPoint(e,t));p.add(n),b.push(n),e+=1})}(),y=!0}function k(){0!==b.length&&(b.forEach(e=>{p.remove(e)}),p.renderAll(),b=[]),y=!1}function j(e){if(m.points.length-m.numberOfNullPolygonPoints>3){if(0===Object.keys(m.points[e]).length){for(let t=e-1;t>-1;t-=1)if(0!==Object.keys(m.points[t]).length){m.points[m.points.length-1]=m.points[t],m.points[t]={};break}}else if(m.points.length-1===e){for(let t=e-1;t>-1;t-=1)if(0!==Object.keys(m.points[t]).length){m.points[e]=m.points[t],m.points[t]={};break}}else m.points[e]={};p.remove(b[e]),b[e]=null,m.numberOfNullPolygonPoints+=1,m.points.length-m.numberOfNullPolygonPoints>3&&console.log("need to signal restrictions"),p.renderAll()}}let N=null,C=!1,O=!1,A=null;function B(){A.forEachObject(e=>{"bndBox"===e.shapeName?e.selectable=!0:(e.lockMovementX=!1,e.lockMovementY=!1),"point"===e.shapeName&&(e.fill="blue",e.radius=3.5)})}function _(e){e.target&&"polygon"===e.target.shapeName&&C?function(e){v()&&(k(),O=!0),P(A,e.target,!0),N=e.target.id}(e):(!e.target&&v()||e.target&&"bndBox"===e.target.shapeName)&&(k(),N=null)}function E(e,t){t?B():e.forEachObject(e=>{e.selectable=!0}),e.defaultCursor="default",e.hoverCursor="move",e.renderAll()}function M(e,t){const n=document.getElementById("labelNamePopUp");n.style.display="block";const o=document.getElementById("canvas-wrapper").getBoundingClientRect(),i=o.top,r=o.left;n.style.top=`${t+i}px`,n.style.left=`${e+r}px`}function I(){document.getElementById("labelNamePopUp").style.display="none"}const X={};let W=!1,Y=null,L=null,T=0;function R(e,t){Y=e,L=t,W=!0}function U(){const e=document.getElementById("label-title").value;E(L),I(),Y.set("id",T),T+=1,X[Y[Y.id]]=e,W=!1}function S(){return W}function $(e,t){e.discardActiveObject(),t||function(e){e.forEachObject(e=>{e.selectable=!1})}(e),e.defaultCursor="crosshair",e.hoverCursor="crosshair",e.renderAll()}let H=null,F=[],D=!0,z=!1,q=0,G=null;function J(){H.remove(z),z=null}function K(){return null!==z}function Q(e){const t=H.getPointer(e.e);(function(e){return!(!z||G.x===e.x)})(t)||(e.target&&e.target.shapeName&&"firstPoint"===e.target.shapeName?function(e){const t=[];F.forEach(e=>{t.push({x:e.left,y:e.top}),H.remove(e)}),J();const n=new i.a.Polygon(t,r.newPolygon);H.add(n),z=null,D=!1,R(n,H),M(e.x,e.y)}(t):D&&function(e){const t=new i.a.Circle(r.newPoint(q,e));q+=1,0===F.length&&t.set(r.firstPoint);let n=[e.x,e.y,e.x,e.y];if(z){(n=z.get("points")).push({x:e.x,y:e.y});const t=new i.a.Polygon(n,r.newTempPolygon);H.remove(z),H.add(t),z=t,H.renderAll()}else{const t=[{x:e.x,y:e.y}],n=new i.a.Polygon(t,r.newTempPolygon);z=n,H.add(n)}F.push(t),H.add(t),H.selection=!1}(t))}function V(){!function(){const e=z.get("points"),t=[];e.forEach(e=>{Object.keys(e).length>0&&t.push({x:e.x,y:e.y})}),z.set({points:t}),H.renderAll();let n=0;const o=[];H.forEachObject(e=>{"point"===e.shapeName&&(e.set(r.changeRemovablePointToTemp(n)),0===n&&e.set(r.firstPoint),n+=1,o.push(e))}),F=o,q=n,H.renderAll(),t[F.length]={x:t[0].x,y:t[0].y},z.set({points:t}),H.renderAll(),$(H,!0),H.renderAll()}()}const Z={};function ee(e,t){return{left:e.origX,top:e.origY,width:t.x-e.origX,height:t.y-e.origY,stroke:"rgba(255,0,0)",strokeWidth:2,fill:"rgba(255,0,0,0)",shapeName:"bndBoxTemp"}}Z.tempBndBoxProps=ee,Z.finalBndBoxProps={fill:"rgba(255,0,0,0)",shapeName:"bndBox",objectCaching:!1,selectable:!1};let te=null,ne=!1,oe=!1;const ie={};function re(e){(te=e).backgroundImage&&(ne=!0,$(te),te.discardActiveObject()),e.on("mouse:down",()=>{!function(){if(ne){oe=!0;const e=te.getPointer(te.e);ie.origX=e.x,ie.origY=e.y,ie.rect=new i.a.Rect(Z.tempBndBoxProps(ie,e)),te.add(ie.rect)}}()}),e.on("mouse:move",e=>{!function(e){if(!oe)return;const t=te.getPointer(e.e);ie.origX>t.x&&ie.rect.set({left:Math.abs(t.x)}),ie.origY>t.y&&ie.rect.set({top:Math.abs(t.y)}),ie.rect.set({width:Math.abs(ie.origX-t.x)}),ie.rect.set({height:Math.abs(ie.origY-t.y)}),te.renderAll()}(e)}),e.on("mouse:up",e=>{!function(e){if(oe){ne=!1,oe=!1,ie.rect.setCoords(),ie.rect.set(Z.finalBndBoxProps),E(te);const t=te.getPointer(e.e);R(ie.rect,te),M(t.x,t.y)}}(e)})}function ae(e,t){t?V():(D=!0,(H=e).discardActiveObject(),$(H)),e.on("mouse:down",e=>{(!e.target||e.target&&"tempPoint"!==e.target.shapeName)&&Q(e)}),e.on("object:moving",e=>{!function(e){if(z){const t=e.target.getCenterPoint().x,n=e.target.getCenterPoint().y;z.points[e.target.pointId]={x:t,y:n}}}(e)}),e.on("mouse:move",e=>{!function(e){if(z){const t=H.getPointer(e.e);G=t;const n=z.get("points");n[F.length]={x:t.x,y:t.y},z.set({points:n})}H.renderAll()}(e)}),e.on("mouse:over",t=>{t.target&&t.target.selectable?e.hoverCursor="move":e.hoverCursor="crosshair"})}function se(e){A=e,e.on("mouse:down",e=>{!function(e){e.target&&("polygon"===e.target.shapeName&&e.target.id!==N?C=!0:"point"===e.target.shapeName&&j(e.target.pointId))}(e)}),e.on("mouse:over",e=>{!function(e){e.target&&"point"===e.target.shapeName&&(e.target.stroke="red",A.renderAll())}(e)}),e.on("mouse:up",e=>{_(e)}),e.on("mouse:out",e=>{!function(e){e.target&&"point"===e.target.shapeName&&(e.target.stroke="black",A.renderAll())}(e)})}let le=null;function ce(e){var t;t=e,z.get("points").length-=1,P(le=t,z,!0,!0),e.on("mouse:down",e=>{!function(e){e.target&&"point"===e.target.shapeName&&j(e.target.pointId)}(e)}),e.on("mouse:over",e=>{!function(e){e.target&&"point"===e.target.shapeName&&(e.target.stroke="red",le.renderAll())}(e)}),e.on("mouse:up",e=>{}),e.on("mouse:out",e=>{!function(e){e.target&&"point"===e.target.shapeName&&(e.target.stroke="black",le.renderAll())}(e)})}let ue=!1,fe=!1,de=null,ge=!1;function he(e,t){var n,o;ge?(n=t,o=e.target,x(n,o),n.discardActiveObject(),w(),de=e.target.id):w(),ue=!1}function pe(){!function(){const e=m._calcDimensions();m.set({left:e.left,top:e.top,height:e.height,width:e.width,pathOffset:{x:e.left+e.width/2,y:e.top+e.height/2}}),m.setCoords(),p.renderAll()}(),fe=!1}function me(){k(),de=null}function be(e){e.target?(p&&(p.preserveObjectStacking=!1),"bndBox"===e.target.shapeName&&v()?(me(),ge=!1):"polygon"===e.target.shapeName&&e.target.id!==de?ge=!0:(p.preserveObjectStacking=!0,ge=!1)):ge=!1}function ye(e,t){ue?he(e,t):ge?function(e,t){v()&&k(),P(t,e.target),de=e.target.id}(e,t):fe?pe():e.target&&"polygon"===e.target.shapeName?(p.discardActiveObject(),b.forEach(e=>{e&&e.bringForward()}),y=!0):!e.target&&v()&&me()}function ve(e){e.target&&("polygon"===e.target.shapeName?(v()&&k(),ue=!0):"point"===e.target.shapeName&&(!function(e){const{left:t}=e.target,{top:n}=e.target,o=e.target;m.points[o.pointId]={x:t,y:n}}(e),fe=!0))}function we(e){e.on("mouse:down",e=>{be(e)}),e.on("mouse:up",t=>{ye(t,e)}),e.on("object:moving",e=>{ve(e)}),e.on("object:scaling",e=>{!function(e){if("bndBox"===e.target.shapeName){const t=e.target;t.width*=t.scaleX,t.height*=t.scaleY,t.scaleX=1,t.scaleY=1}}(e)}),e.on("mouse:over",t=>{!function(e,t){e.target&&"point"!==e.target.shapeName&&(e.target.set("fill","rgba(255,0,0,0.2)"),t.renderAll())}(t,e)}),e.on("mouse:out",t=>{t.target&&"point"!==t.target.shapeName&&("bndBox"===t.target.shapeName?function(e){e.target.set("fill","rgba(255,0,0,0")}(t):"polygon"===t.target.shapeName&&function(e){e.target.set("fill","rgba(255,0,0,0.01)")}(t),e.renderAll())})}function xe(e){e.__eventListeners&&(e.__eventListeners["mouse:down"]=[],e.__eventListeners["mouse:over"]=[],e.__eventListeners["mouse:out"]=[],e.__eventListeners["mouse:move"]=[],e.__eventListeners["mouse:up"]=[],e.__eventListeners["object:moving"]=[])}let Pe=null,ke=!1,je=!1;function Ne(){xe(Pe),re(Pe),ke=!1,je=!1}function Ce(){xe(Pe),ae(Pe),ke=!1,je=!1}function Oe(){Pe.getActiveObject()?Pe.remove(Pe.getActiveObject()):m&&p.remove(m),je=!1}function Ae(){ke||(xe(Pe),E(Pe,je),we(Pe),je&&(je=!1),ke=!0)}function Be(){var e;je?(xe(Pe),e=Pe,ke=K()?(ae(e,!0),!1):(E(e,!0),we(e),!0),je=!1):(xe(Pe),function(e){const t=K();t?ce(e):t||se(e)}(Pe),function(e){const t=K();t?function(e){e.defaultCursor="default",e.hoverCursor="default",e.renderAll()}(e):t||function(e){!function(e){e.forEachObject(e=>{"bndBox"===e.shapeName?e.selectable=!1:(e.lockMovementX=!0,e.lockMovementY=!0),"point"===e.shapeName&&(e.fill="red",e.radius=4)}),e.renderAll()}(e),e.defaultCursor="default",e.hoverCursor="default"}(e)}(Pe),ke=!1,je=!0)}const _e={uploaded:!1,name:null},Ee={};let Me=null;function Ie(e,t){t?function(e,t){Me.setWidth(t.width),Me.setHeight(t.height),i.a.Image.fromURL(e.src,e=>{Me.setBackgroundImage(e,Me.renderAll.bind(Me),{scaleX:Me.width/e.width,scaleY:Me.height/e.height})})}(e,t):function(e){Me.setWidth(e.width),Me.setHeight(e.height),Me.setBackgroundColor({source:e.src},()=>{Me.renderAll()})}(e)}function Xe(e){const t={},n=Ee.maximumCanvasWidth/e.width;return t.width=Ee.maximumCanvasWidth,t.height=e.height*n,t}function We(){_e.uploaded=!0;const e=this;if(Ee.maximumCanvasHeight<e.height){let t=function(e){const t={},n=Ee.maximumCanvasHeight/e.height;return t.height=Ee.maximumCanvasHeight,t.width=e.width*n,t}(e);Ee.maximumCanvasWidth<t.width&&(t=Xe(t)),Ie(e,t)}else if(Ee.maximumCanvasWidth<e.width){Ie(e,Xe(e))}else Ie(e)}function Ye(e){const t=new Image;t.src=e.target.result,t.onload=We}function Le(e){Me=e,Ee.maximumCanvasHeight=window.innerHeight-54,Ee.maximumCanvasWidth=window.innerWidth-110}function Te(e){return function e(t){let n="";return Object.keys(t).forEach(o=>{"object"==typeof t[o]?n+=`<${o}>${e(t[o])}</${o}>`:n+=`<${o}>${t[o]}</${o}>`}),n}(e)}let Re=null;function Ue(e){const t=document.createElement("a"),n=new Blob([e],{type:"text/plain"});return t.setAttribute("href",window.URL.createObjectURL(n)),t.setAttribute("download",`${new RegExp("^([^.]+)").exec(_e.name)[0]}.xml`),t.dataset.downloadurl=["text/plain",t.download,t.href].join(":"),t.draggable=!0,t.classList.add("dragout"),t}function Se(){if(Re.backgroundImage){!function(e){Ue(e).click()}(Te(function(e,t){const n={};return n.annotations=function(e,t){return{folder:"Unknown",filename:t.name,path:"Unknown",source:{database:"Unknown"},size:{width:e.getWidth(),height:e.getHeight(),depth:1},segmented:0}}(e,t),n.annotations.object=function(e){let t={};return e.forEachObject(e=>{const n=e._objects[0],o=e._objects[1].text;t={name:o,pose:"Unspecified",truncated:1,difficult:0,bndbox:{xmin:n.left,ymin:n.top,xmax:n.left+n.width,ymax:n.top+n.height}}}),t}(e),n}(Re,_e)))}}function $e(){U(),Ae()}function He(){S()&&(I(),L.remove(Y),W=!1)}function Fe(){F[0]&&(F.forEach(e=>{H.remove(e)}),J(),F=[],z=null,q=0),He(),k(),de=null,O&&(B(),O=!1)}function De(e){Fe(),e&&e()}function ze(e){Fe(),function(e){if(e.files&&e.files[0]){const t=new FileReader;_e.name=e.files[0].name,t.onload=Ye,t.readAsDataURL(e.files[0])}}(e)}!function(){const e=new i.a.Canvas("c",{selection:!1});i.a.Object.prototype.transparentCorners=!1,Pe=e,Le(e),function(e){Re=e}(e)}(),function(){window.createNewBndBox=De.bind(this,Ne),window.createNewPolygon=De.bind(this,Ce),window.removePoint=function(e){S()||e&&e()}.bind(this,Be),window.removeShape=De.bind(this,Oe),window.downloadXML=De.bind(this,Se),window.cancel=De.bind(this,Ae),window.uploadImage=ze,window.labelShape=$e}()}]);