!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=fabric},function(e,t,n){"use strict";n.r(t);var o=n(0),i=n.n(o);function r(e,t){t?e.forEachObject(e=>{e.lockMovementX=!1,e.lockMovementY=!1}):(e.forEachObject(e=>{e.selectable=!0}),e.defaultCursor="default",e.hoverCursor="move")}const a={};function s(e,t){return{left:e.origX,top:e.origY,width:t.x-e.origX,height:t.y-e.origY,stroke:"rgba(255,0,0)",strokeWidth:2,fill:"rgba(255,0,0,0)",shapeName:"bndBoxTemp"}}function l(e,t){const n=document.getElementById("labelNamePopUp");n.style.display="block";const o=document.getElementById("canvas-wrapper").getBoundingClientRect(),i=o.top,r=o.left;n.style.top=`${t+i}px`,n.style.left=`${e+r}px`}function c(){document.getElementById("labelNamePopUp").style.display="none"}a.tempBndBoxProps=s,a.finalBndBoxProps={fill:"rgba(255,0,0,0.1)",shapeName:"bndBox",objectCaching:!1};const u={},d={inProgress:!1};let g=null,f=null,h=0;function p(e,t){g=e,f=t,d.inProgress=!0}function m(){const e=document.getElementById("label-title").value;r(f),c(),g.set("id",h),"bndBoxTemp"===g.shapeName&&g.set(a.finalBndBoxProps),h+=1,u[g[g.id]]=e,d.inProgress=!1}function b(e){e.discardActiveObject(),e.renderAll(),e.forEachObject(e=>{e.selectable=!1}),e.defaultCursor="crosshair",e.hoverCursor="crosshair"}let y=null,w=!1,v=!1;const x={};function P(e){(y=e).backgroundImage&&(w=!0,b(y),y.discardActiveObject()),e.on("mouse:down",()=>{!function(){if(w){v=!0;const e=y.getPointer(y.e);x.origX=e.x,x.origY=e.y,x.rect=new i.a.Rect(a.tempBndBoxProps(x,e)),y.add(x.rect)}}()}),e.on("mouse:move",e=>{!function(e){if(!v)return;const t=y.getPointer(e.e);x.origX>t.x&&x.rect.set({left:Math.abs(t.x)}),x.origY>t.y&&x.rect.set({top:Math.abs(t.y)}),x.rect.set({width:Math.abs(x.origX-t.x)}),x.rect.set({height:Math.abs(x.origY-t.y)}),y.renderAll()}(e)}),e.on("mouse:up",e=>{!function(e){if(v){w=!1,v=!1,x.rect.setCoords(),x.rect.selectable=!1,r(y);const t=y.getPointer(e.e);p(x.rect,y),l(t.x,t.y)}}(e)})}const C={};function j(e,t,n){const o=n.getPointer(t.e);return{radius:3.5,fill:"#ffffff",stroke:"#333333",strokeWidth:.5,left:o.x,top:o.y,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"tempPoint",pointId:e,objectCaching:!1}}function k(e,t){return{radius:3.5,fill:"blue",stroke:"#333333",strokeWidth:.5,left:t.x,top:t.y,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"point",objectCaching:!1,pointId:e,perPixelTargetFind:!0}}function N(e,t){return{radius:4,fill:"red",stroke:"#333333",strokeWidth:.5,left:t.x,top:t.y,selectable:!0,hasBorders:!1,hasControls:!1,originX:"center",originY:"center",shapeName:"point",objectCaching:!1,pointId:e,perPixelTargetFind:!0,lockMovementX:!0,lockMovementY:!0}}C.newPolygon={stroke:"rgba(255,0,0)",strokeWidth:1.75,fill:"rgba(237, 237, 237, 0.01)",perPixelTargetFind:!0,hasBorders:!1,hasControls:!1,shapeName:"polygon",selectable:!1,evented:!0,objectCaching:!1,numberOfNullPolygonPoints:0},C.newTempPolygon={stroke:"#333333",strokeWidth:.8,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1},C.newLine={strokeWidth:1.1,fill:"#999999",stroke:"#999999",class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1},C.firstPoint={fill:"red",shapeName:"firstPoint"},C.newPoint=j,C.existingPolygonPoint=k,C.removablePolygonPoint=N;let O=null,B=[],A=[],_=!0,E=null,I=!1,L=0;function M(){A.forEach(e=>{O.remove(e)}),O.remove(I).remove(E)}function W(){B[0]&&(B.forEach(e=>{O.remove(e)}),M(),B=[],A=[],I=null,E=null,L=0)}function X(e){e.target&&e.target.shapeName&&"firstPoint"===e.target.shapeName&&function(e){const t=[];B.forEach(e=>{t.push({x:e.left,y:e.top}),O.remove(e)}),M();const n=new i.a.Polygon(t,C.newPolygon);O.add(n),E=null,I=null,_=!1;const o=O.getPointer(e.e);p(n,O),l(o.x,o.y)}(e),_&&function(e){const t=O.getPointer(e.e),n=new i.a.Circle(C.newPoint(L,e,O));L+=1,0===B.length&&n.set(C.firstPoint);let o=[t.x,t.y,t.x,t.y];const r=new i.a.Line(o,C.newLine);if(I){(o=I.get("points")).push({x:t.x,y:t.y});const e=new i.a.Polygon(o,C.newTempPolygon);O.remove(I),O.add(e),I=e,O.renderAll()}else{const e=[{x:t.x,y:t.y}],n=new i.a.Polygon(e,C.newTempPolygon);I=n,O.add(n)}E=r,B.push(n),A.push(r),O.add(n),O.selection=!1}(e)}function Y(e){O=e,_=!0,W(),O.discardActiveObject(),b(O),e.on("mouse:down",e=>{(!e.target||e.target&&"tempPoint"!==e.target.shapeName)&&X(e)}),e.on("object:moving",e=>{!function(e){I&&(I.points[e.target.pointId]={x:e.target.getCenterPoint().x,y:e.target.getCenterPoint().y})}(e)}),e.on("mouse:move",e=>{!function(e){if(E&&"line"===E.class){const t=O.getPointer(e.e);E.set({x2:t.x,y2:t.y});const n=I.get("points");n[B.length]={x:t.x,y:t.y},I.set({points:n}),O.renderAll()}O.renderAll()}(e)}),e.on("mouse:over",t=>{t.target&&t.target.selectable?e.hoverCursor="move":e.hoverCursor="crosshair"})}let T=null,U=[],$=null,H=null;function R(e,t,n,o){!function(e,t,n,o){T=e,U=t,$=n,H=o}(e,t,n,o);const r=function(){const e=new i.a.Polygon([],H.newPolygon);return e.set({id:T.id,selectable:!0}),e}();$.add(r);const a=function(e){let t=0;const n=[];return e.forEach(e=>{const o=new i.a.Circle(H.existingPolygonPoint(t,e));$.add(o),U.push(o),n.push({x:o.left-1,y:o.top-1}),t+=1}),n}(function(){const e=T.calcTransformMatrix();return T.get("points").map(e=>new i.a.Point(e.x-T.pathOffset.x,e.y-T.pathOffset.y)).map(t=>i.a.util.transformPoint(t,e))}());return $.remove(T),(T=r).set("points",a),function(){const e=T._calcDimensions();T.set({left:e.left,top:e.top,height:e.height,width:e.width,pathOffset:{x:e.left+e.width/2,y:e.top+e.height/2}}),T.setCoords(),$.renderAll()}(),T}let S=null,F=null,D=[],z=!1;function q(){return z}function G(){F=R(F,D,S,C),z=!0}function J(e,t){S=e,F=t}function K(e,t,n){J(e,t),e.discardActiveObject(),n?function(){let e=0;F.get("points").forEach(t=>{const n=new i.a.Circle(C.removablePolygonPoint(e,t));S.add(n),D.push(n),e+=1})}():function(){let e=0;F.get("points").forEach(t=>{const n=new i.a.Circle(C.existingPolygonPoint(e,t));S.add(n),D.push(n),e+=1})}(),z=!0}function Q(){0!==D.length&&(D.forEach(e=>{S.remove(e)}),S.renderAll(),D=[]),z=!1}let V=null,Z=!1;function ee(e){e.on("mouse:down",e=>{e.target&&("polygon"===e.target.shapeName&&e.target.id!==V?Z=!0:"point"===e.target.shapeName&&function(e){if(F.points.length-F.numberOfNullPolygonPoints>3){if(0===Object.keys(F.points[e]).length)F.points[F.points.length-1]=F.points[e-1],F.points[e-1]={};else if(F.points.length-1===e){for(let t=e-1;t>-1;t-=1)if(0!==Object.keys(F.points[t]).length){F.points[e]=F.points[t],F.points[t]={};break}}else F.points[e]={};S.remove(D[e]),D[e]=null,F.numberOfNullPolygonPoints+=1,F.points.length-F.numberOfNullPolygonPoints!=3&&console.log("need to signal restrictions"),S.renderAll()}}(e.target.pointId))}),e.on("mouse:over",t=>{t.target&&"point"===t.target.shapeName&&(t.target.stroke="red",e.renderAll())}),e.on("mouse:up",t=>{t.target&&"polygon"===t.target.shapeName&&Z?function(e,t){q()&&Q(),K(t,e.target,!0),V=e.target.id}(t,e):!t.target&&q()&&(Q(),V=null)}),e.on("mouse:out",t=>{t.target&&"point"===t.target.shapeName&&(t.target.stroke="black",e.renderAll())})}let te=!1,ne=!1,oe=null,ie=!1;function re(e,t){var n,o;ie?(n=t,o=e.target,J(n,o),n.discardActiveObject(),G(),oe=e.target.id):G(),te=!1}function ae(){!function(){const e=F._calcDimensions();F.set({left:e.left,top:e.top,height:e.height,width:e.width,pathOffset:{x:e.left+e.width/2,y:e.top+e.height/2}}),F.setCoords(),S.renderAll()}(),ne=!1}function se(){Q(),oe=null}function le(e,t){te?re(e,t):ie?function(e,t){q()&&Q(),K(t,e.target),oe=e.target.id}(e,t):ne?ae():e.target&&"polygon"===e.target.shapeName?(S.discardActiveObject(),D.forEach(e=>{e&&e.bringForward()}),z=!0):!e.target&&q()&&se()}function ce(e){e.target&&("polygon"===e.target.shapeName?(q()&&Q(),te=!0):"point"===e.target.shapeName&&(!function(e){const{left:t}=e.target,{top:n}=e.target,o=e.target;F.points[o.pointId]={x:t,y:n}}(e),ne=!0))}function ue(e){e.on("mouse:down",e=>{!function(e){e.target?"bndBox"===e.target.shapeName&&q()?(se(),ie=!1):ie="polygon"===e.target.shapeName&&e.target.id!==oe:ie=!1}(e)}),e.on("mouse:up",t=>{le(t,e)}),e.on("object:moving",e=>{ce(e)}),e.on("object:scaling",e=>{"bndBox"===e.target.shapeName&&(e.target.width*=e.target.scaleX,e.target.height*=e.target.scaleY,e.target.scaleX=1,e.target.scaleY=1)}),e.on("mouse:over",t=>{t.target&&"point"!==t.target.shapeName&&(t.target.set("fill","rgba(255,0,0,0.2)"),e.renderAll())}),e.on("mouse:out",t=>{t.target&&"point"!==t.target.shapeName&&("bndBox"===t.target.shapeName?t.target.set("fill","rgba(255,0,0,0"):"polygon"===t.target.shapeName&&t.target.set("fill","rgba(255,0,0,0.01)"),e.renderAll())})}function de(e){e.__eventListeners&&(e.__eventListeners["mouse:down"]=[],e.__eventListeners["mouse:over"]=[],e.__eventListeners["mouse:out"]=[],e.__eventListeners["mouse:move"]=[],e.__eventListeners["mouse:up"]=[],e.__eventListeners["object:moving"]=[])}let ge=null,fe=!1,he=!1;function pe(){de(ge),P(ge),fe=!1}function me(){de(ge),Y(ge),fe=!1}function be(){ge.getActiveObject()?ge.remove(ge.getActiveObject()):F&&S.remove(F)}function ye(){fe||(de(ge),r(ge,he),ue(ge),he&&(he=!1),fe=!0)}function we(){var e;de(ge),ee(ge),(e=ge).forEachObject(e=>{"bndBox"===e.shapeName?e.selectable=!1:(e.lockMovementX=!0,e.lockMovementY=!0),"point"===e.shapeName&&(e.fill="red",e.radius=4)}),e.defaultCursor="default",e.hoverCursor="default",e.renderAll(),fe=!1,he=!0}const ve={uploaded:!1,name:null},xe={};let Pe=null;function Ce(e,t){t?function(e,t){Pe.setWidth(t.width),Pe.setHeight(t.height),i.a.Image.fromURL(e.src,e=>{Pe.setBackgroundImage(e,Pe.renderAll.bind(Pe),{scaleX:Pe.width/e.width,scaleY:Pe.height/e.height})})}(e,t):function(e){Pe.setWidth(e.width),Pe.setHeight(e.height),Pe.setBackgroundColor({source:e.src},()=>{Pe.renderAll()})}(e)}function je(e){const t={},n=xe.maximumCanvasWidth/e.width;return t.width=xe.maximumCanvasWidth,t.height=e.height*n,t}function ke(){ve.uploaded=!0;const e=this;if(xe.maximumCanvasHeight<e.height){let t=function(e){const t={},n=xe.maximumCanvasHeight/e.height;return t.height=xe.maximumCanvasHeight,t.width=e.width*n,t}(e);xe.maximumCanvasWidth<t.width&&(t=je(t)),Ce(e,t)}else if(xe.maximumCanvasWidth<e.width){Ce(e,je(e))}else Ce(e)}function Ne(e){const t=new Image;t.src=e.target.result,t.onload=ke}function Oe(e){Pe=e,xe.maximumCanvasHeight=window.innerHeight-54,xe.maximumCanvasWidth=window.innerWidth-110}function Be(e){return function e(t){let n="";return Object.keys(t).forEach(o=>{"object"==typeof t[o]?n+=`<${o}>${e(t[o])}</${o}>`:n+=`<${o}>${t[o]}</${o}>`}),n}(e)}let Ae=null;function _e(e){const t=document.createElement("a"),n=new Blob([e],{type:"text/plain"});return t.setAttribute("href",window.URL.createObjectURL(n)),t.setAttribute("download",`${new RegExp("^([^.]+)").exec(ve.name)[0]}.xml`),t.dataset.downloadurl=["text/plain",t.download,t.href].join(":"),t.draggable=!0,t.classList.add("dragout"),t}function Ee(){if(Ae.backgroundImage){!function(e){_e(e).click()}(Be(function(e,t){const n={};return n.annotations=function(e,t){return{folder:"Unknown",filename:t.name,path:"Unknown",source:{database:"Unknown"},size:{width:e.getWidth(),height:e.getHeight(),depth:1},segmented:0}}(e,t),n.annotations.object=function(e){let t={};return e.forEachObject(e=>{const n=e._objects[0],o=e._objects[1].text;t={name:o,pose:"Unspecified",truncated:1,difficult:0,bndbox:{xmin:n.left,ymin:n.top,xmax:n.left+n.width,ymax:n.top+n.height}}}),t}(e),n}(Ae,ve)))}}function Ie(){m(),ye()}function Le(){d.inProgress&&(c(),f.remove(g),d.inProgress=!1,d.inProgress=!1)}function Me(){W(),Le(),Q(),oe=null}function We(e){Me(),e&&e()}function Xe(e){Me(),function(e){if(e.files&&e.files[0]){const t=new FileReader;ve.name=e.files[0].name,t.onload=Ne,t.readAsDataURL(e.files[0])}}(e)}!function(){const e=new i.a.Canvas("c",{selection:!1});i.a.Object.prototype.transparentCorners=!1,ge=e,Oe(e),function(e){Ae=e}(e)}(),function(){window.createNewBndBox=We.bind(this,pe),window.createNewPolygon=We.bind(this,me),window.removePoint=we,window.removeShape=We.bind(this,be),window.downloadXML=We.bind(this,Ee),window.cancel=We.bind(this,ye),window.uploadImage=Xe,window.labelShape=Ie}()}]);